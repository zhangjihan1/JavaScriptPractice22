<!-- 
下代码属于Deep Knowledge Education，其用途仅为教学展示，任何人不可复制，使用，或用于任何其他用途，违者必追究法律责任。
The code below belongs to Deep Knowledge Education. 
It is only for demonstration as part of education process.
You cannot copy, use the code, nor can you use it for any other purpose.
Offenders must be held accountable.
Date: 17 Sep 2020
-->
<!-- 
    练习说明：使用哈希表来设计一个有函数缓存功能的函数
    练习知识点：
            * Function Catching 函数缓存
            * JavaScript 哈希表 Map
            * Javascript 闭包
            * Dynamic Programming 动态规划
 -->

<!DOCTYPE html>
<html>

<head>
    <title> Get Images By Calling APIs</title>
    <script>
        //设计一个计算 阶乘 n! 的函数
        //Factorial calculations: n * (n-1) * (n-2) * ... (2) * (1)

        window.onload = function () {

            //(1) 绑定点击事件
            document.getElementById("btn").addEventListener("click", calcHandler)

            //(2) 定义点击处理函数
            let calcFactorical = factorialCatching();
            function calcHandler() {
                let n = parseInt(document.getElementById("userInput").value);
                let msg = calcFactorical(n);
                document.getElementById("result").innerHTML = msg;
            }

            //(3) 定义计算阶乘函数
            function factorialCatching() {
                let catche = new Map();

                return (n) => {
                    if (catche.has(n)) {
                        let msg = `Fetch Factorical Result of ${n}! from catching. <br> Result: ${catche.get(n)}`;
                        return msg;
                    } else {
                        
                        let res = 1;
                        for (let i = 1; i <= n; i++) {
                            res = res * i;
                        }
                        catche.set(n, res);
                        let msg = `Calculate Factorical ${n}! and save result into catche. <br> Result: ${res}`;
                        return msg;
                    }
                }
    
            }


        }


    </script>
</head>

<body>
    <h1 id="title">函数缓存练习</h1>
    <div>
        <label name="userInput">Factorial to calculate: </label>
        <input id="userInput" name="userInput" type="text">
        <button id="btn">Calculate</button>
        <p id="result"></p>
    </div>

</body>

</html>